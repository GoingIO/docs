title: 日志收容框架scribe
notebook: 技术相关
tags: 日志收容, scribe

[TOC]

## 简介

scribe 是Facebook开源的日志收集系统，在facebook内部被广泛使用。

它可以保证在任何网络和机器故障时的正常运行， 但他并不提供任何的事务保障。如果客户机的scribe 实例无法将数据发送到scribe 中央服务时， 它会将数据暂存客户机本地，等scribe中央服务或网络恢复后重新上传。
为了避免中央服务在启动期间超负荷连接，the resender在重新连接的时候会等待一段时间，如果德中央服务已经接近于满载，中央服务将返回TRY_LATER，告诉resender过一段时间再尝试连接。

中央服务在向hdf或者分布式文件系统写数据的时候，采用统一的方式来处理错误。 如果文件系统挂了，，scribe服务回家数据写到本地，直到文件系统恢复， 然后将数据从本地文件系统传输到远程文件系统。在传输和重发的过程中，需要保证消息的有序。

下面的情况会造成数据的丢失：
+ 如果客户端既不能连接到本地文件系统，也不能连接到中央服务
+ 如果scribe服务崩溃， 会造成内存中的少量数据丢失，但磁盘数据不会丢失
+ 多种情况并发，如resender 服务连接到任何的忠言服务，而且本地磁盘已满
+ 小概率的延迟导致的消息冲突






[scribe](https://github.com/facebookarchive/scribe/wiki/Scribe-Overview)
