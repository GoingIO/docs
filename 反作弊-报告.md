title: 渠道反作弊
notebook: 糖豆
tags: 机器学习,渠道反作弊

[TOC]
# 数据准备
  反作弊分析， 由用户的静态数据和行为数据出发，统计新增用户的关键特征，用来区分作弊用户与反作弊用户
## 数据源
### 用户注册数据
用户的注册信息, 是用户的基本信息，用于描述用户的静态特征(mysql的user表)

![Alt text](/Users/junjie.cheng/.atom/evnd/tmp/clipboard_20161110_152121.png "Optional title")

### 底层服务数据
底层服务数据，包括了用户在使用App过程中产生的访问底层数据接口的信息(hive的user_action表)

![Alt text](/Users/junjie.cheng/.atom/evnd/tmp/clipboard_20161110_152611.png "Optional title")

## 数据预处理
通过将用户注册数据和底层服务数据的整理，抽取出一个月的新增用户的关键特征， 作为我们的样本集

![Alt text](/Users/junjie.cheng/.atom/evnd/tmp/clipboard_20161110_153457.png "Optional title")

### 抽样
抽取渠道 "gf", "yingyongbao", "alading" , "xiaomi", "360", "A004" 的数据作为训练和检验的样本
+ 将 "gf", "yingyongbao", "alading" 三个渠道的数据作为正样本， 为正样本标注label值为1.0
+ 将 "xiaomi", "360", "A004" 三个渠道的数据作为负样本， 为负样本标注label为0.0

|  样本类型  |   数据源  |   labels |  features |
|-----------|----------|----------|-----------|
|  正样本   | 渠道为"gf", "yingyongbao", "alading" | 1.0 | Vector |
|  负样本   | 渠道为"xiaomi", "360", "A004" | 0.0 | Vector |

### 样本标量化
将如下的类别型特征转化为数值型特征

|类别特征         |数值特征  |
|-------|-----------|
|manufacture  |   manufacture_index  |
|device       |   device_index  |
|os_version   |   os_version_index  |
|dic_f        |   dic_f_index  |
|div_f        |   div_f_index  |
|resolution   |   resolution_index  |
|u_client     |   u_client_index  |
|u_nettype    |   u_nettype_index  |
|u_province   |   u_province_index  |
|u_city       |   u_city_index  |
|u_netop      |   u_netop_index  |
|u_agent      |   u_agent_index  |
|u_xff        |   u_xff_index  |

将特征中所有的数值型特征转为Double型

|  字段 |   数据类型  |
|--------|----------|
|is_reg | toDouble |
|avatar | toDouble |
|type | toDouble |
|signature | toDouble |
|space_pic | toDouble |
|follow_ucnt | toDouble |
|manufacture_index | toDouble |
|device_index | toDouble |
|os_version_index | toDouble |
|dic_f_index | toDouble |
|div_f_index | toDouble |
|hour_f | toDouble |
|resolution_index | toDouble |
|u_client | toDouble |
|u_nettype_index | toDouble |
|u_province_index | toDouble |
|u_city_index | toDouble |
|u_netop_index | toDouble |
|u_agent_index | toDouble |
|u_xff_index | toDouble |
|search_cnt | toDouble |
|sug_cnt | toDouble |
|homepage_cnt | toDouble |
|hp_hot_cnt | toDouble |
|hp_dancemusic_cnt | toDouble |
|hp_talent_cnt | toDouble |
|hp_category_cnt | toDouble |
|hp_new_cnt | toDouble |
|hp_follow_cnt | toDouble |
|hp_greatest_cnt | toDouble |
|hp_live_cnt | toDouble |
|hp_stage_cnt | toDouble |
|hp_more_cnt | toDouble |
|feaddback_cnt | toDouble |
|showdance_cnt | toDouble |
|upload_cnt | toDouble |
|serv_cnt | toDouble |
|serv_unique_cnt | toDouble |
|vcnt | toDouble |
|vv | toDouble |
|vp | toDouble |
|vst | toDouble |
|vc | toDouble |
|vsf | toDouble |
|vf | toDouble |
|vs | toDouble |
|vd | toDouble |

### 构造特征向量
将标量化之后的特征组合为特征向量, 形成标准的LIBSVM数据文件, 作为标准的样本集

|  labels  | features |
|----------|----------|
|  1.0 | 7:3.0 8:421.0 9:8.0 10:8.0 11:19.0 12:1.0 13:2.0 15:4.0 16:51.0 18:620.0 19:423735.0 22:1.0 29:2.0 36:53.0 37:15.0 38:4.0 39:4.0 40:22.0 41:133.0 |
|  1.0 | 7:3.0 8:68.0 10:1.0 11:22.0 12:2.0 13:2.0 15:20.0 16:284.0 17:3.0 18:64.0 19:157721.0 22:1.0 24:1.0 36:25.0 37:13.0 38:2.0 39:2.0 40:15.0 41:72.0|
|......| ......|

# 模型选择与训练
## 模型选择
### 常用的分类模型
反作弊的场景是典型的分类问题，可以使用的分类问题有如下几种

| 模型 | 中文名 |
|-----|-----|
| Logistic regression  |  逻辑回归    |
| Decision tree classifier | 决策树    |
| Random forest classifier |   随机森林  |
| Gradient-boosted tree classifier |     |
| Multilayer perceptron classifier |     |
| One-vs-Rest classifier |   一对多SVM分类？  |
| Naive Bayes |  朴素贝叶斯    |

### 模型的比较

## 训练
将标准的样本集做7-3拆分，其中7份作为训练样本，使用```决策树模型```进行模型训练，3份作为预测样本，用于检测模型

训练后形成的决策树如下：

    If (feature 6 <= 0.0)
     If (feature 9 <= 2.0)
      If (feature 8 <= 6.0)
       If (feature 20 <= 0.0)
        If (feature 9 <= 1.0)
         Predict: 0.0
        Else (feature 9 > 1.0)
         Predict: 0.0
       Else (feature 20 > 0.0)
        If (feature 9 <= 1.0)
         Predict: 0.0
        Else (feature 9 > 1.0)
         Predict: 0.0
      Else (feature 8 > 6.0)
       If (feature 9 <= 1.0)
        If (feature 17 <= 631.0)
         Predict: 0.0
        Else (feature 17 > 631.0)
         Predict: 0.0
       Else (feature 9 > 1.0)
        If (feature 35 <= 3.0)
         Predict: 0.0
        Else (feature 35 > 3.0)
         Predict: 1.0
     Else (feature 9 > 2.0)
      If (feature 9 <= 8.0)
       If (feature 44 <= 8.0)
        If (feature 30 <= 0.0)
         Predict: 1.0
        Else (feature 30 > 0.0)
         Predict: 1.0
       Else (feature 44 > 8.0)
        If (feature 7 <= 2.0)
         Predict: 1.0
        Else (feature 7 > 2.0)
         Predict: 0.0
      Else (feature 9 > 8.0)
       If (feature 9 <= 14.0)
        If (feature 9 <= 10.0)
         Predict: 0.0
        Else (feature 9 > 10.0)
         Predict: 1.0
       Else (feature 9 > 14.0)
        If (feature 9 <= 20.0)
         Predict: 0.0
        Else (feature 9 > 20.0)
         Predict: 1.0
    Else (feature 6 > 0.0)
     If (feature 9 <= 1.0)
      If (feature 36 <= 3.0)
       If (feature 10 <= 15.0)
        If (feature 17 <= 766.0)
         Predict: 1.0
        Else (feature 17 > 766.0)
         Predict: 1.0
       Else (feature 10 > 15.0)
        If (feature 10 <= 19.0)
         Predict: 0.0
        Else (feature 10 > 19.0)
         Predict: 1.0
      Else (feature 36 > 3.0)
       If (feature 6 <= 3.0)
        If (feature 6 <= 1.0)
         Predict: 1.0
        Else (feature 6 > 1.0)
         Predict: 1.0
       Else (feature 6 > 3.0)
        If (feature 14 <= 0.0)
         Predict: 1.0
        Else (feature 14 > 0.0)
         Predict: 1.0
     Else (feature 9 > 1.0)
      If (feature 9 <= 2.0)
       If (feature 36 <= 3.0)
        If (feature 10 <= 16.0)
         Predict: 1.0
        Else (feature 10 > 16.0)
         Predict: 1.0
       Else (feature 36 > 3.0)
        If (feature 6 <= 15.0)
         Predict: 1.0
        Else (feature 6 > 15.0)
         Predict: 1.0
      Else (feature 9 > 2.0)
       If (feature 9 <= 8.0)
        If (feature 14 <= 30.0)
         Predict: 1.0
        Else (feature 14 > 30.0)
         Predict: 1.0
       Else (feature 9 > 8.0)
        If (feature 9 <= 10.0)
         Predict: 1.0
        Else (feature 9 > 10.0)
         Predict: 1.0

# 模型验证
